<!DOCTYPE html>
<meta charset="utf-8">
<style>


.land {
  fill: #ddd;
}

.border {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
  stroke-linecap: round;
}

.bubble {
  fill:#EC6767;
  fill-opacity: .5;
  stroke: #EC6767;
  stroke-width: .5px;
}



</style>

<body>
<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>

var width = 960,
    height = 600;

var path = d3.geo.path()
    .projection(null);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var radius = d3.scale.sqrt()
    .domain([0, 1e6])
    .range([0, 800]);

var legend = svg.append("g")
    .attr("class", "legend")
    .attr("transform", "translate(" + (width - 50) + "," + (height - 20) + ")")
  .selectAll("g")
    .data([1e6, 3e6, 6e6])
  .enter().append("g");


var toolTip = d3.select('body')
    .append('div')
    .style('position', 'absolute')
    .style('padding', '0 10px')
    .style('background', '#fff')
    .style('opacity', 0)
    .style('font-family', 'Open Sans')
    .style('z-index', 1000);

// legend.append("circle")
//     .attr("cy", function(d) { return -radius(d); })
//     .attr("r", radius);
//
// legend.append("text")
//     .attr("y", function(d) { return -2 * radius(d); })
//     .attr("dy", "1.3em")
//     .text(d3.format(".1s"));


d3.json("us.json", function(error, usa) {
      if (error) return console.error(error);

      //build the main land area
    svg.append('path')
    		.datum(topojson.feature(usa, usa.objects.nation))
    		.attr('class', 'land')
    		.attr('d', path);

    svg.append("path")
        .datum(topojson.mesh(usa, usa.objects.states, function(a, b) { return a !== b; }))
        .attr("class", "border border--state")
        .attr("d", path);


    svg.selectAll('.states')
        // retrieve the features so that id is accessed
        .data(topojson.feature(usa, usa.objects.counties).features)
        .enter().append('path')
        .attr('id', function(d) { return d.id; })
        .attr("class", "states states-hover")
        .attr('d', path)


             //add Tool Tip
        .on('mouseover', function(d, i){
      		toolTip.transition()
      		  .style('opacity', .9)
      		  .style('left', (d3.event.pageX) + 'px')
      		  .style('top', (d3.event.pageY) + 'px')
      		tempColor = this.style.fill; //store current color

      		if(d.properties.name != null || d.properties.name != undefined){
      			toolTip.html(d.properties.name + ", " + d.properties.population)
      		} else {
      			toolTip.html("")
      		}
      	})
      	.on('mouseout', function(){
      		d3.select(this)
      		 .transition().delay(400).duration(800)
      		 .style('opacity', 1)
      		 .style('fill', tempColor)
      	})






    svg.append("g")
        .attr("class", "bubble")
        .selectAll("circle")
        .data(topojson.feature(usa, usa.objects.counties).features
          .sort(function(a, b) { //sort population low to high
            return b.properties.population - a.properties.population;
          }) //sort
        ) //data
        .enter().append("circle")
       .on('mouseover', function(d, i){
          d3.select(this).attr('class', 'hover')
        })
        .on('mouseout', function(d, i){
          d3.select(this).attr('class', '')
        })
        .attr("transform", function(d) {
          return "translate(" + path.centroid(d) + ")"; //Computes the projected centroid
        })
        .attr("r", function(d) {
          return radius(d.properties.population); //radius var with input (domain) and output (range)
        })

          });

</script>
